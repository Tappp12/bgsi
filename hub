--==================================================
-- CONFIG + WEBHOOK SCRIPT LOADER
--==================================================

getgenv().Config = getgenv().Config or {}
local cfg = getgenv().Config

if cfg.Webhook_enabled == nil then cfg.Webhook_enabled = true end
if cfg.Discord_ID == nil then cfg.Discord_ID = '' end
if cfg.Webhook == nil then cfg.Webhook = '' end
if cfg.Ignore_AutoDeleted == nil then cfg.Ignore_AutoDeleted = false end
if cfg.Secret_Only == nil then cfg.Secret_Only = true end

if cfg.AntiAFK == nil then cfg.AntiAFK = false end
if cfg.AntiAFKScript == nil then
    cfg.AntiAFKScript = 'https://raw.githubusercontent.com/SamF-Web/bgsi-roblox-scripts/refs/heads/main/antiafk.lua'
end

if cfg.ClaimPlaytime == nil then cfg.ClaimPlaytime = true end
if cfg.PlaytimeScript == nil then
    cfg.PlaytimeScript = 'https://raw.bgsi-botting.xyz/core/playtime.lua'
end

cfg.WebhookScript = cfg.WebhookScript
    or 'https://raw.githubusercontent.com/Tappp12/bgsi/refs/heads/main/secrets'

if cfg.ChristmasFarm == nil then cfg.ChristmasFarm = false end
if cfg.FestivalSpin == nil then cfg.FestivalSpin = false end
if cfg.ChristmasEventScript == nil then
    cfg.ChristmasEventScript = "https://raw.githubusercontent.com/Tappp12/bgsi/refs/heads/main/winter"
end

do
    local success, err = pcall(function()
        loadstring(game:HttpGet(cfg.WebhookScript))()
    end)
    if not success then
        warn('[BGSI GUI] Failed to load webhook script:', err)
    end
end

if cfg.ClaimPlaytime then
    local ok, errPT = pcall(function()
        loadstring(game:HttpGet(cfg.PlaytimeScript))()
    end)
    if not ok then
        warn('[BGSI GUI] Failed to load Playtime claimer script:', errPT)
    else
        print('[BGSI GUI] Playtime claimer started on launch.')
    end
end

if cfg.ChristmasFarm or cfg.FestivalSpin then
    local ok, errX = pcall(function()
        loadstring(game:HttpGet(cfg.ChristmasEventScript))()
    end)
    if not ok then
        warn("[BGSI GUI] Failed to load Christmas Event script:", errX)
    else
        print("[BGSI GUI] Christmas Event script loaded on launch.")
    end
end

--==================================================
-- SERVICES & VARIABLES
--==================================================

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")

local localPlayer = Players.LocalPlayer
local character = localPlayer.Character or localPlayer.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

local autoPotionEnabled = false
local selectedPotion = 'Mythic'

local fastHatchEnabled = false
local autoClaimSeason = false

local RemoteRoot = ReplicatedStorage
    :WaitForChild("Shared")
    :WaitForChild("Framework")
    :WaitForChild("Network")
    :WaitForChild("Remote")

local remote = RemoteRoot:WaitForChild("RemoteEvent")
local remoteFunc = RemoteRoot:WaitForChild("RemoteFunction")

local powerupItems = localPlayer.PlayerGui.ScreenGui.Inventory.Frame.Inner.Items.Main.ScrollingFrame.Powerups.Items

local controls

local function LockMovement()
    local success, err = pcall(function()
        if not controls then
            local playerModule = localPlayer:WaitForChild("PlayerScripts"):WaitForChild("PlayerModule")
            controls = require(playerModule):GetControls()
        end
        controls:Disable()
    end)
    if not success then
        warn("[BGSI GUI] Failed to lock movement:", err)
    end
end

local function UnlockMovement()
    if controls then
        local success, err = pcall(function()
            controls:Enable()
        end)
        if not success then
            warn("[BGSI GUI] Failed to unlock movement:", err)
        end
    end
end

--==================================================
-- MINIGAME HELPERS / CONFIG
--==================================================

local SettingsMini = {
    Skip       = false,
    DiceSpeed  = "Fast (Fewer Rewards)",
    Difficulty = "Insane",
}

local MainConfigMini = {
    AutoClaw        = false,
    AutoDart        = false,
    AutoCart        = false,
    AutoMatch       = false,
    AutoCircusMatch = false,
    AutoCircusFarm  = false,
    DiceRoll        = "Dice",
    DiceRoll2       = false,
    TilesDice       = "infinity",
    Distance        = 1,
    GoldenTile      = false,
}

local Board = require(ReplicatedStorage.Client.Gui.Frames.Board)
local BoardUtil = require(ReplicatedStorage.Shared.Utils.BoardUtil)

local function HasTileAhead(startIndex, distance, tileType)
    for _ = 1, distance do
        local nextIndex = startIndex + 1
        startIndex = (#BoardUtil.Nodes < nextIndex and 1) or nextIndex
        local node = BoardUtil.Nodes[startIndex]
        if node and node.Type == tileType then
            return true
        end
    end
    return false
end

local function PullClawCapsule()
    local claw = Workspace:FindFirstChild("ClawMachine")
    if not claw then return end

    for _, m in ipairs(claw:GetChildren()) do
        if m.Name == "Capsule" then
            for _, part in ipairs(m:GetDescendants()) do
                if part:IsA("Part") or part:IsA("MeshPart") then
                    local center = claw:FindFirstChild("CenterPart") or hrp
                    local targetCF = center.CFrame * CFrame.new(0.8, 0, 0.7)
                    game:GetService("TweenService"):Create(
                        part,
                        TweenInfo.new(1),
                        { CFrame = targetCF }
                    ):Play()
                    return
                end
            end
        end
    end
end

local function HideClawVisual()
    local claw = Workspace:FindFirstChild("ClawMachine")
    if claw then
        for _, d in ipairs(claw:GetDescendants()) do
            if d:IsA("Part") or d:IsA("MeshPart") then
                d.Transparency = 1
                d.CanCollide = false
            end
        end
    end
    for _, gui in ipairs(localPlayer.PlayerGui:GetChildren()) do
        if gui.Name == "TransitionGui" then
            for _, f in ipairs(gui:GetChildren()) do
                if f:IsA("Frame") then
                    f.Visible = false
                end
            end
        end
    end
end

--==================================================
-- CIRCUS AUTO FARM CONFIG
--==================================================

local CircusPetMatchPos   = CFrame.new(-2327.25439, 10.2435932, 285.830658)
local GrandmasterChestPos = CFrame.new(-2368.09106, 12.3162966, 325.654266)

-- how often to open the chest (seconds)
local CircusChestCooldown = 3

local function OpenGrandmasterChest()
    remote:FireServer("UnlockEventChest", "Circus Chest", false)
end

--==================================================
-- WINDOW
--==================================================

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = 'BGSI Auto Hatch + Webhook',
    LoadingTitle = 'BGSI GUI',
    LoadingSubtitle = 'Auto Hatch & Webhook Controls',
    ConfigurationSaving = {
        Enabled = true,
        FolderName = 'BGSIConfigs',
        FileName = 'MainConfig'
    },
})

--==================================================
-- TABS
--==================================================

local MainTab = Window:CreateTab('Hatching', 4483362458)
local MinigameTab = Window:CreateTab('Minigames', 4483362458)
local WebhookTab = Window:CreateTab('Webhook', 4483362458)
local SettingsTab = Window:CreateTab('Settings', 'settings')

--==================================================
-- HATCHING TAB
--==================================================

MainTab:CreateToggle({
    Name = 'Auto Hatch Last Egg',
    CurrentValue = false,
    Flag = 'FastHatch',
    Callback = function(Value)
        fastHatchEnabled = Value
        print('[BGSI GUI] Fast hatch enabled:', fastHatchEnabled)
    end,
})

MainTab:CreateToggle({
    Name = 'Enable Anti AFK',
    CurrentValue = cfg.AntiAFK,
    Flag = 'AntiAFK',
    Callback = function(Value)
        cfg.AntiAFK = Value
        if Value then
            local ok, err2 = pcall(function()
                loadstring(game:HttpGet(cfg.AntiAFKScript))()
            end)
            if not ok then
                warn('[BGSI GUI] Failed to load AntiAFK script:', err2)
            else
                print('[BGSI GUI] AntiAFK script started.')
            end
        else
            print('[BGSI GUI] AntiAFK turned OFF in config (rejoin to fully stop AntiAFK loop).')
        end
    end,
})

MainTab:CreateDropdown({
    Name = 'Auto Potion Type',
    Options = { 'Mythic', 'Coins', 'Lucky', 'Speed' },
    CurrentOption = {'Mythic'},
    Flag = 'PotionType',
    Callback = function(Option)
        if type(Option) == 'table' then
            selectedPotion = Option[1]
        else
            selectedPotion = Option
        end
        print('[BGSI GUI] Selected potion:', selectedPotion)
    end,
})

MainTab:CreateToggle({
    Name = 'Auto Use Potion (every 0.15s)',
    CurrentValue = false,
    Flag = 'AutoPotion',
    Callback = function(Value)
        autoPotionEnabled = Value
        print('[BGSI GUI] Auto Potion Enabled:', autoPotionEnabled)
    end,
})

MainTab:CreateToggle({
    Name = 'Auto-claim Playtime Rewards',
    CurrentValue = cfg.ClaimPlaytime,
    Flag = 'ClaimPlaytime',
    Callback = function(Value)
        cfg.ClaimPlaytime = Value
        if Value then
            local ok, errPT = pcall(function()
                loadstring(game:HttpGet(cfg.PlaytimeScript))()
            end)
            if not ok then
                warn('[BGSI GUI] Failed to load Playtime claimer script:', errPT)
            else
                print('[BGSI GUI] Playtime claimer started.')
            end
        else
            print('[BGSI GUI] Playtime claimer disabled (rejoin to fully stop it).')
        end
    end,
})

MainTab:CreateToggle({
    Name = "Christmas Farm (TP houses)",
    CurrentValue = cfg.ChristmasFarm,
    Flag = "ChristmasFarm",
    Callback = function(Value)
        cfg.ChristmasFarm = Value
        print("[BGSI GUI] ChristmasFarm:", cfg.ChristmasFarm)
        if Value then
            LockMovement()
            local ok, errX = pcall(function()
                loadstring(game:HttpGet(cfg.ChristmasEventScript))()
            end)
            if not ok then
                warn("[BGSI GUI] Failed to load Christmas Event script:", errX)
                UnlockMovement()
            else
                print("[BGSI GUI] Christmas Event script (farm) started.")
            end
        else
            UnlockMovement()
            print("[BGSI GUI] Christmas farm turned OFF in config (rejoin to fully stop loop).")
        end
    end,
})

MainTab:CreateToggle({
    Name = "Festival Spin Tickets",
    CurrentValue = cfg.FestivalSpin,
    Flag = "FestivalSpin",
    Callback = function(Value)
        cfg.FestivalSpin = Value
        print("[BGSI GUI] FestivalSpin:", cfg.FestivalSpin)
        if Value then
            local ok, errX = pcall(function()
                loadstring(game:HttpGet(cfg.ChristmasEventScript))()
            end)
            if not ok then
                warn("[BGSI GUI] Failed to load Christmas Event script:", errX)
            else
                print("[BGSI GUI] Christmas Event script (spin) started.")
            end
        else
            print("[BGSI GUI] Festival spin turned OFF in config (rejoin to fully stop loop).")
        end
    end,
})

--==================================================
-- MINIGAMES TAB
--==================================================

MinigameTab:CreateSection("Main")

MinigameTab:CreateDropdown({
    Name = "Robot Claw Speed",
    Options = { "Fast (Fewer Rewards)", "Slow (More Rewards)" },
    CurrentOption = { SettingsMini.DiceSpeed },
    Flag = "ClawSpeed",
    Callback = function(opt)
        SettingsMini.DiceSpeed = (type(opt) == "table") and opt[1] or opt
    end,
})

MinigameTab:CreateDropdown({
    Name = "Minigame Difficulty",
    Options = { "Insane", "Hard", "Medium", "Easy" },
    CurrentOption = { SettingsMini.Difficulty },
    Flag = "MiniDiff",
    Callback = function(opt)
        SettingsMini.Difficulty = (type(opt) == "table") and opt[1] or opt
    end,
})

MinigameTab:CreateToggle({
    Name = "Auto Robot Claw",
    CurrentValue = false,
    Flag = "AutoClaw",
    Callback = function(v)
        MainConfigMini.AutoClaw = v
        task.spawn(function()
            while MainConfigMini.AutoClaw do
                if SettingsMini.Skip then
                    remote:FireServer("SkipMinigameCooldown", "Robot Claw")
                end
                local prompt = localPlayer.PlayerGui.ScreenGui:FindFirstChild("Prompt")
                if prompt then
                    local btn = prompt.Frame.Main.Buttons.Template.Button
                    if btn and btn.Activated then
                        firesignal(btn.Activated)
                    end
                else
                    if SettingsMini.DiceSpeed == "Fast (Fewer Rewards)" then
                        remote:FireServer("StartMinigame", "Robot Claw", SettingsMini.Difficulty)
                        task.wait(2)
                        HideClawVisual()
                        remote:FireServer("FinishMinigame")
                    else
                        if Workspace:FindFirstChild("ClawMachine") then
                            PullClawCapsule()
                            task.wait(3.5)
                        else
                            remote:FireServer("StartMinigame", "Robot Claw", SettingsMini.Difficulty)
                        end
                    end
                end
                task.wait(1)
            end
        end)
    end,
})

MinigameTab:CreateToggle({
    Name = "Auto Hyper Darts",
    CurrentValue = false,
    Flag = "AutoDart",
    Callback = function(v)
        MainConfigMini.AutoDart = v
        task.spawn(function()
            while MainConfigMini.AutoDart do
                if SettingsMini.Skip then
                    remote:FireServer("SkipMinigameCooldown", "Hyper Darts")
                end
                local prompt = localPlayer.PlayerGui.ScreenGui:FindFirstChild("Prompt")
                if prompt then
                    local btn = prompt.Frame.Main.Buttons.Template.Button
                    if btn and btn.Activated then
                        firesignal(btn.Activated)
                    end
                else
                    remote:FireServer("StartMinigame", "Hyper Darts", SettingsMini.Difficulty)
                    task.wait(1)
                    remote:FireServer("FinishMinigame")
                end
                task.wait(1)
            end
        end)
    end,
})

MinigameTab:CreateToggle({
    Name = "Auto Cart Escape",
    CurrentValue = false,
    Flag = "AutoCart",
    Callback = function(v)
        MainConfigMini.AutoCart = v
        task.spawn(function()
            while MainConfigMini.AutoCart do
                if SettingsMini.Skip then
                    remote:FireServer("SkipMinigameCooldown", "Cart Escape")
                end
                local prompt = localPlayer.PlayerGui.ScreenGui:FindFirstChild("Prompt")
                if prompt then
                    local btn = prompt.Frame.Main.Buttons.Template.Button
                    if btn and btn.Activated then
                        firesignal(btn.Activated)
                    end
                else
                    remote:FireServer("StartMinigame", "Cart Escape", SettingsMini.Difficulty)
                    task.wait(1)
                    remote:FireServer("FinishMinigame")
                end
                task.wait(1)
            end
        end)
    end,
})

MinigameTab:CreateToggle({
    Name = "Auto Pet Match",
    CurrentValue = false,
    Flag = "AutoMatch",
    Callback = function(v)
        MainConfigMini.AutoMatch = v
        task.spawn(function()
            while MainConfigMini.AutoMatch do
                if SettingsMini.Skip then
                    remote:FireServer("SkipMinigameCooldown", "Pet Match")
                end
                local prompt = localPlayer.PlayerGui.ScreenGui:FindFirstChild("Prompt")
                if prompt then
                    local btn = prompt.Frame.Main.Buttons.Template.Button
                    if btn and btn.Activated then
                        firesignal(btn.Activated)
                    end
                else
                    remote:FireServer("StartMinigame", "Pet Match", SettingsMini.Difficulty)
                    task.wait(1)
                    remote:FireServer("FinishMinigame")
                end
                task.wait(1)
            end
        end)
    end,
})

MinigameTab:CreateToggle({
    Name = "Auto Circus Pet Match",
    CurrentValue = false,
    Flag = "AutoCircusMatch",
    Callback = function(v)
        MainConfigMini.AutoCircusMatch = v
        task.spawn(function()
            while MainConfigMini.AutoCircusMatch do
                if SettingsMini.Skip then
                    remote:FireServer("SkipMinigameCooldown", "Circus Pet Match")
                end

                local prompt = localPlayer.PlayerGui.ScreenGui:FindFirstChild("Prompt")
                if prompt then
                    local btn = prompt.Frame.Main.Buttons.Template.Button
                    if btn and btn.Activated then
                        firesignal(btn.Activated)
                    end
                else
                    remote:FireServer("StartMinigame", "Circus Pet Match", SettingsMini.Difficulty)
                    task.wait(1)
                    remote:FireServer("FinishMinigame")
                end

                task.wait(1)
            end
        end)
    end,
})

MinigameTab:CreateToggle({
    Name = "Circus Grandmaster Chest Farm",
    CurrentValue = false,
    Flag = "AutoCircusFarm",
    Callback = function(v)
        MainConfigMini.AutoCircusFarm = v
        task.spawn(function()
            local lastChestTime = 0

            while MainConfigMini.AutoCircusFarm do
                -- only run this while Circus Pet Match auto is also on
                if MainConfigMini.AutoCircusMatch and hrp then
                    local now = tick()
                    if now - lastChestTime >= CircusChestCooldown then
                        lastChestTime = now

                        local originalCF = hrp.CFrame

                        -- TP to chest
                        hrp.CFrame = GrandmasterChestPos
                        task.wait(0.08)

                        -- open chest
                        OpenGrandmasterChest()
                        task.wait(0.05)

                        -- TP back to where you were in the minigame
                        hrp.CFrame = originalCF
                    end
                end

                task.wait(0.1)
            end
        end)
    end,
})

MinigameTab:CreateToggle({
    Name = "Auto Skip Enabled Minigames (Super Ticket)",
    CurrentValue = false,
    Flag = "MiniSkip",
    Callback = function(v)
        SettingsMini.Skip = v
    end,
})

MinigameTab:CreateSection("Dice")

MinigameTab:CreateDropdown({
    Name = "Dice List",
    Options = { "Dice", "Giant Dice", "Golden Dice" },
    CurrentOption = { MainConfigMini.DiceRoll },
    Flag = "DiceList",
    Callback = function(opt)
        MainConfigMini.DiceRoll = (type(opt) == "table") and opt[1] or opt
    end,
})

MinigameTab:CreateToggle({
    Name = "Auto Roll Selected Dice",
    CurrentValue = false,
    Flag = "AutoDiceRoll",
    Callback = function(v)
        MainConfigMini.DiceRoll2 = v
        task.spawn(function()
            while MainConfigMini.DiceRoll2 do
                local boardIndex = localPlayer:GetAttribute("BoardIndex")
                if MainConfigMini.GoldenTile and boardIndex
                    and HasTileAhead(boardIndex, MainConfigMini.Distance, MainConfigMini.TilesDice)
                    and powerupItems:FindFirstChild("Golden Dice")
                then
                    remoteFunc:InvokeServer("RollDice", "Golden Dice")
                    remote:FireServer("ClaimTile")
                else
                    remoteFunc:InvokeServer("RollDice", MainConfigMini.DiceRoll)
                    remote:FireServer("ClaimTile")
                end
                task.wait(0.5)
            end
        end)
    end,
})

MinigameTab:CreateSection("Golden Dice (when auto roll)")

MinigameTab:CreateToggle({
    Name = "Auto Use Golden Dice to Get Tiles",
    CurrentValue = false,
    Flag = "GoldenTile",
    Callback = function(v)
        MainConfigMini.GoldenTile = v
    end,
})

MinigameTab:CreateDropdown({
    Name = "Tiles List",
    Options = {
        "chance","basic","basic-dice","giant-dice","golden-dice",
        "dice","infinity","super-ticket","special-egg","dice-key"
    },
    CurrentOption = { MainConfigMini.TilesDice },
    Flag = "TilesList",
    Callback = function(opt)
        MainConfigMini.TilesDice = (type(opt) == "table") and opt[1] or opt
    end,
})

MinigameTab:CreateInput({
    Name = "Tiles Distance",
    PlaceholderText = tostring(MainConfigMini.Distance),
    RemoveTextAfterFocusLost = false,
    Flag = "TilesDistance",
    Callback = function(text)
        local n = tonumber(text)
        if type(n) == "number" then
            MainConfigMini.Distance = n
        end
    end,
})

--==================================================
-- WEBHOOK TAB
--==================================================

WebhookTab:CreateToggle({
    Name = 'Enable Webhook Alerts',
    CurrentValue = cfg.Webhook_enabled,
    Flag = 'WebhookEnabled',
    Callback = function(Value)
        cfg.Webhook_enabled = Value
    end,
})

WebhookTab:CreateToggle({
    Name = 'Secret Only Webhooks',
    CurrentValue = cfg.Secret_Only,
    Flag = 'SecretOnly',
    Callback = function(Value)
        cfg.Secret_Only = Value
    end,
})

WebhookTab:CreateInput({
    Name = 'Discord User ID (for ping)',
    PlaceholderText = cfg.Discord_ID ~= '' and cfg.Discord_ID or '12345678',
    RemoveTextAfterFocusLost = false,
    Flag = 'DiscordID',
    Callback = function(Text)
        cfg.Discord_ID = Text
    end,
})

WebhookTab:CreateInput({
    Name = 'Webhook URL',
    PlaceholderText = (cfg.Webhook ~= '' and 'Webhook set' or 'https://discord.com/api/webhooks/...'),
    RemoveTextAfterFocusLost = false,
    Flag = 'WebhookURL',
    Callback = function(Text)
        cfg.Webhook = Text
    end,
})

WebhookTab:CreateParagraph({
    Title = 'Info',
    Content = 'Auto Deleted pets are automatically ignored and not send to webhookðŸ’¥',
})

WebhookTab:CreateToggle({
    Name = 'Auto-Claim Season Pass',
    CurrentValue = false,
    Flag = 'ClaimSeason',
    Callback = function(Value)
        autoClaimSeason = Value
        print('[BGSI GUI] Auto-Claim Season Pass:', autoClaimSeason)
    end,
})

--==================================================
-- SETTINGS TAB
--==================================================

SettingsTab:CreateSection('Configuration Manager')

SettingsTab:CreateInput({
    Name = 'Config Name',
    PlaceholderText = 'Enter config name',
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        getgenv().CurrentConfigName = Text
    end,
})

SettingsTab:CreateButton({
    Name = 'Save Current Config',
    Callback = function()
        local configName = getgenv().CurrentConfigName or 'DefaultConfig'
        local HttpService = game:GetService('HttpService')
        local configData = {}
        for flag, element in pairs(Rayfield.Flags) do
            if element.Type == 'ColorPicker' then
                configData[flag] = {
                    R = element.Color.R * 255,
                    G = element.Color.G * 255,
                    B = element.Color.B * 255
                }
            else
                configData[flag] = element.CurrentValue or element.CurrentKeybind or element.CurrentOption
            end
        end
        local fileName = 'BGSIConfigs/' .. configName .. '.json'
        writefile(fileName, HttpService:JSONEncode(configData))
        Rayfield:Notify({
            Title = 'Config Saved',
            Content = 'Saved config: ' .. configName,
            Duration = 3,
            Image = 'check',
        })
    end,
})

SettingsTab:CreateInput({
    Name = 'Load Config Name',
    PlaceholderText = 'Enter config to load',
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        getgenv().LoadConfigName = Text
    end,
})

SettingsTab:CreateButton({
    Name = 'Load Selected Config',
    Callback = function()
        local configName = getgenv().LoadConfigName or 'DefaultConfig'
        local HttpService = game:GetService('HttpService')
        local fileName = 'BGSIConfigs/' .. configName .. '.json'
        if isfile(fileName) then
            local configData = HttpService:JSONDecode(readfile(fileName))
            for flag, value in pairs(configData) do
                if Rayfield.Flags[flag] then
                    if Rayfield.Flags[flag].Type == 'ColorPicker' then
                        Rayfield.Flags[flag]:Set(Color3.fromRGB(value.R, value.G, value.B))
                    else
                        Rayfield.Flags[flag]:Set(value)
                    end
                end
            end
            Rayfield:Notify({
                Title = 'Config Loaded',
                Content = 'Loaded config: ' .. configName,
                Duration = 3,
                Image = 'check',
            })
        else
            Rayfield:Notify({
                Title = 'Config Not Found',
                Content = 'Config "' .. configName .. '" does not exist',
                Duration = 3,
                Image = 'alert-triangle',
            })
        end
    end,
})

SettingsTab:CreateButton({
    Name = 'Show Saved Configs',
    Callback = function()
        local files = listfiles and listfiles('BGSIConfigs') or {}
        local names = {}
        for _, path in ipairs(files) do
            if path:sub(-5):lower() == ".json" then
                local name = path:match("BGSIConfigs/(.+)%.json") or path
                table.insert(names, name)
            end
        end
        if #names == 0 then
            Rayfield:Notify({
                Title = 'Configs',
                Content = 'No configs found in BGSIConfigs folder.',
                Duration = 3,
                Image = 'info',
            })
        else
            local listStr = table.concat(names, ", ")
            print("[BGSI GUI] Saved configs:", listStr)
            Rayfield:Notify({
                Title = 'Configs',
                Content = 'Configs: ' .. listStr,
                Duration = 5,
                Image = 'info',
            })
        end
    end,
})

SettingsTab:CreateSection('Auto-Load')

SettingsTab:CreateParagraph({
    Title = 'Info',
    Content = 'Auto-load on start is disabled. Use "Load Selected Config" after choosing a name to load.'
})

--==================================================
-- LAST EGG HOOK + FAST HATCH LOOP
--==================================================

local lastEggName
local lastEggCount

do
    local mt = getrawmetatable(game)
    local oldNamecall = mt.__namecall
    setreadonly(mt, false)
    mt.__namecall = newcclosure(function(self, ...)
        local args = { ... }
        local method = getnamecallmethod()
        if method == "FireServer"
            and self == remote
            and args[1] == "HatchEgg"
        then
            lastEggName = args[2]
            lastEggCount = args[3]
            print("[BGSI GUI] Last egg set to:", lastEggName, lastEggCount)
        end
        return oldNamecall(self, ...)
    end)
    setreadonly(mt, true)
end

task.spawn(function()
    while true do
        if fastHatchEnabled and lastEggName and lastEggCount then
            remote:FireServer("HatchEgg", lastEggName, lastEggCount)
        end
        task.wait(0.05)
    end
end)

--==================================================
-- AUTO POTION LOOP
--==================================================

task.spawn(function()
    while true do
        if autoPotionEnabled and selectedPotion then
            if selectedPotion == 'Mythic' then
                remote:FireServer('UsePotion', 'Mythic', 2, 10)
            elseif selectedPotion == 'Coins' then
                remote:FireServer('UsePotion', 'Coins', 2, 10)
            elseif selectedPotion == 'Lucky' then
                remote:FireServer('UsePotion', 'Lucky', 2, 10)
            elseif selectedPotion == 'Speed' then
                remote:FireServer('UsePotion', 'Speed', 2, 10)
            end
        end
        task.wait(0.15)
    end
end)

--==================================================
-- AUTO SEASON-PASS CLAIM LOOP
--==================================================

task.spawn(function()
    while true do
        if autoClaimSeason then
            remote:FireServer('ClaimSeason')
        end
        task.wait(5)
    end
end)
